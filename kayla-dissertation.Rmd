
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
#knitr::opts_knit$set(root.dir=normalizePath('../'))
```


# Preliminary Setup and Data Import

Load libraries.  If you don't have any then you need to run, for example, install.packages("fmsb") in the console ONCE.  Don't include it in the code itself.
```{r load libraries}
library(httr)
library(tidyverse)
library(janitor)
library(broom)
library(tidyr)
library(fmsb) # contains ChronbachAlpha 
```

Get Data directly from OSF and then save it as a .rds file.  You need to run this chunk once since we're not updating or changing the excel spreadsheet. I but a `#` in front of it all to make this point.  As long as you have 'kayla.rds' in your folder then you're good to go. 
```{r import data, eval=FALSE, include=FALSE}
#if (!file.exists('kayla.xlsx')) {
#   data <- GET('osf.io/xnfg5//?action=download',
#                write_disk('kayla.xlsx'))#, overwrite = TRUE))
#}

# get data and clean
#kayla.tb <- readxl::read_excel('kayla.xlsx')
#kayla.tb <- kayla.tb %>%  
#  clean_names()
# saved it as an .rds
#saveRDS(kayla.tb, file = "kayla.rds")
```

Open the Saved Data.  You'll likely run this everytime as long as you close your R project.  Make sure you're working in your R project.  The top right shoudl have a blue cube that says "dissertation", if i'm remembering correctly.
```{r open data}
kayla_tb  <- read_rds("kayla.rds")
```


# Data Wrangling

Rename the SASB variables in the excel to match the SASB clusters.  
```{r rename sasb variables}

# we rename introject first

kayla_processed <- kayla_tb %>%
  rename(intcl1b = sasb_1, intcl2b = sasb_6,
         intcl3b = sasb_3,
         intcl4b = sasb_4,
         intcl5b = sasb_8,
         intcl6b = sasb_5,
         intcl7b = sasb_2,
         intcl8b = sasb_7,
         intcl1w = sasb_ia1,
         intcl2w = sasb_ia6,
         intcl3w = sasb_ia3,
         intcl4w = sasb_ia4,
         intcl5w = sasb_ia8,
         intcl6w = sasb_ia5,
         intcl7w = sasb_ia2,
         intcl8w = sasb_ia7,
  
     # renaming friend first 16 for pre      
         sostcl1p = sasb_fp14,
         sostcl2p = sasb_fp1,
         sostcl3p = sasb_fp6,
         sostcl4p = sasb_fp13,
         sostcl5p = sasb_fp9,
         sostcl6p = sasb_fp3,
         sostcl7p = sasb_fp12,
         sostcl8p = sasb_fp4,
         sosicl1p = sasb_fp11,
         sosicl2p = sasb_fp8,
         sosicl3p = sasb_fp15,
         sosicl4p = sasb_fp5,
         sosicl5p = sasb_fp10,
         sosicl6p = sasb_fp7,
         sosicl7p = sasb_fp16,
         sosicl8p = sasb_fp2,
    # renaming friend second 16 for pre
         ssotcl1p = sasb_fp30,
         ssotcl2p = sasb_fp17,
         ssotcl3p = sasb_fp22,
         ssotcl4p = sasb_fp29,
         ssotcl5p = sasb_fp25,
         ssotcl6p = sasb_fp19,
         ssotcl7p = sasb_fp28,
         ssotcl8p = sasb_fp20,
         ssoicl1p = sasb_fp27,
         ssoicl2p = sasb_fp24,
         ssoicl3p = sasb_fp31,
         ssoicl4p = sasb_fp21,
         ssoicl5p = sasb_fp26,
         ssoicl6p = sasb_fp23,
         ssoicl7p = sasb_fp32,
         ssoicl8p = sasb_fp18,
    
    # below is for after.  notice how the first sixteen and second sixteen are the same as above EXCEPT for the 'p' is now an 'a' 
    
        sostcl1a = sasb_fa14,
         sostcl2a = sasb_fa1,
         sostcl3a = sasb_fa6,
         sostcl4a = sasb_fa13,
         sostcl5a = sasb_fa9,
         sostcl6a = sasb_fa3,
         sostcl7a = sasb_fa12,
         sostcl8a = sasb_fa4,
         sosicl1a = sasb_fa11,
         sosicl2a = sasb_fa8,
         sosicl3a = sasb_fa15,
         sosicl4a = sasb_fa5,
         sosicl5a = sasb_fa10,
         sosicl6a = sasb_fa7,
         sosicl7a = sasb_fa16,
         sosicl8a = sasb_fa2,
    # second sixten for after     
         ssotcl1a = sasb_fa30,
         ssotcl2a = sasb_fa17,
         ssotcl3a = sasb_fa22,
         ssotcl4a = sasb_fa29,
         ssotcl5a = sasb_fa25,
         ssotcl6a = sasb_fa19,
         ssotcl7a = sasb_fa28,
         ssotcl8a = sasb_fa20,
         ssoicl1a = sasb_fa27,
         ssoicl2a = sasb_fa24,
         ssoicl3a = sasb_fa31,
         ssoicl4a = sasb_fa21,
         ssoicl5a = sasb_fa26,
         ssoicl6a = sasb_fa23,
         ssoicl7a = sasb_fa32,
         ssoicl8a = sasb_fa18)

#  below, try and do the same as above for parent.  remmember the numbers are the same, just the letters need to switch from 'fa' and 'fp' to 'pp' and 'pa'.
# if you want really want it to work, then notice that you'll have to take the parentheses off after the last one above `sasb_fa18` and add a comma.  The parenthese was ending it but since you're adding some you have to take that off, add a comma, and then put the parenthes back on when you're done.

```



The following creates weighted summary scores for SASB Affiliation and Autonomy by SASB surface.
```{r SASB weighted summary scores}
###### 1. Introject Pre (introject)
## Affiliation
kayla_processed <- kayla_processed %>%
  mutate(intaffb = (intcl1b*0) + (intcl2b*4.5) + (intcl3b*7.8) + (intcl4b*4.5) + (intcl5b*0) + (intcl6b*-4.5) + (intcl7b*-7.8) + (intcl8b*-4.5),
         intautb = (intcl1b*7.8) + (intcl2b*4.5) + (intcl3b*0) + (intcl4b*-4.5) + (intcl5b*-7.8) + (intcl6b*-4.5) + (intcl7b*0) + (intcl8b*4.5),
         intaffw = (intcl1w*0) + (intcl2w*4.5) + (intcl3w*7.8) + (intcl4w*4.5) + (intcl5w*0) + (intcl6w*-4.5) + (intcl7w*-7.8) + (intcl8w*-4.5),
         intautw = (intcl1w*7.8) + (intcl2w*4.5) + (intcl3w*0) + (intcl4w*-4.5) + (intcl5w*-7.8) + (intcl6w*-4.5) + (intcl7w*0) + (intcl8w*4.5),

          # significant other (friend) focused on subject - affiliation pre and autonomy pre scores
         sostaffp = (sostcl1p*0) + (sostcl2p*4.5) + (sostcl3p*7.8) + (sostcl4p*4.5) + (sostcl5p*0) + (sostcl6p*-4.5) + (sostcl7p*-7.8) + (sostcl8p*-4.5),
         sostautp = (sostcl1p*7.8) + (sostcl2p*4.5) + (sostcl3p*0) + (sostcl4p*-4.5) + (sostcl5p*-7.8) + (sostcl6p*-4.5) + (sostcl7p*0) + (sostcl8p*4.5),
         # significant other reacting to subjects - affiliation and pre and autonomy pre
         sosiaffp = (sosicl1p*0) + (sosicl2p*4.5) + (sosicl3p*7.8) + (sosicl4p*4.5) + (sosicl5p*0) + (sosicl6p*-4.5) + (sosicl7p*-7.8) + (sosicl8p*-4.5),
         sosiautp = (sosicl1p*7.8) + (sosicl2p*4.5) + (sosicl3p*0) + (sosicl4p*-4.5) + (sosicl5p*-7.8) + (sosicl6p*-4.5) + (sosicl7p*0) + (sosicl8p*4.5),
         
         # subject acting towards significant other - affiliation pre and autonomy pre
        ssotaffp = (ssotcl1p*0) + (ssotcl2p*4.5) + (ssotcl3p*7.8) + (ssotcl4p*4.5) + (ssotcl5p*0) + (ssotcl6p*-4.5) + (ssotcl7p*-7.8) + (sostcl8p*-4.5),
         ssotautp = (ssotcl1p*7.8) + (ssotcl2p*4.5) + (ssotcl3p*0) + (ssotcl4p*-4.5) + (ssotcl5p*-7.8) + (ssotcl6p*-4.5) + (ssotcl7p*0) + (ssotcl8p*4.5),
         # subject reacting towards significant other - affiliation pre and autonomy pre
        ssoiaffp = (ssoicl1p*0) + (ssoicl2p*4.5) + (ssoicl3p*7.8) + (ssoicl4p*4.5) + (ssoicl5p*0) + (ssoicl6p*-4.5) + (ssoicl7p*-7.8) + (sostcl8p*-4.5),
         ssoiautp = (ssoicl1p*7.8) + (ssoicl2p*4.5) + (ssoicl3p*0) + (ssoicl4p*-4.5) + (ssoicl5p*-7.8) + (ssoicl6p*-4.5) + (ssoicl7p*0) + (ssoicl8p*4.5),

        ##### after ##############        
        
          # significant other (friend) focused on subject - affiliation after and autonomy after scores
         sostaffa = (sostcl1a*0) + (sostcl2a*4.5) + (sostcl3a*7.8) + (sostcl4a*4.5) + (sostcl5a*0) + (sostcl6a*-4.5) + (sostcl7a*-7.8) + (sostcl8a*-4.5),
         sostauta = (sostcl1a*7.8) + (sostcl2a*4.5) + (sostcl3a*0) + (sostcl4a*-4.5) + (sostcl5a*-7.8) + (sostcl6a*-4.5) + (sostcl7a*0) + (sostcl8a*4.5),
         # significant other reacting to subjects - affiliation and after and autonomy after
         sosiaffa = (sosicl1a*0) + (sosicl2a*4.5) + (sosicl3a*7.8) + (sosicl4a*4.5) + (sosicl5a*0) + (sosicl6a*-4.5) + (sosicl7a*-7.8) + (sosicl8a*-4.5),
         sosiauta = (sosicl1a*7.8) + (sosicl2a*4.5) + (sosicl3a*0) + (sosicl4a*-4.5) + (sosicl5a*-7.8) + (sosicl6a*-4.5) + (sosicl7a*0) + (sosicl8a*4.5),
         
         # subject acting towards significant other - affiliation after and autonomy after
        ssotaffa = (ssotcl1a*0) + (ssotcl2a*4.5) + (ssotcl3a*7.8) + (ssotcl4a*4.5) + (ssotcl5a*0) + (ssotcl6a*-4.5) + (ssotcl7a*-7.8) + (sostcl8a*-4.5),
         ssotauta = (ssotcl1a*7.8) + (ssotcl2a*4.5) + (ssotcl3a*0) + (ssotcl4a*-4.5) + (ssotcl5a*-7.8) + (ssotcl6a*-4.5) + (ssotcl7a*0) + (ssotcl8a*4.5),
         # subject reacting towards significant other - affiliation after and autonomy after
        ssoiaffa = (ssoicl1a*0) + (ssoicl2a*4.5) + (ssoicl3a*7.8) + (ssoicl4a*4.5) + (ssoicl5a*0) + (ssoicl6a*-4.5) + (ssoicl7a*-7.8) + (sostcl8a*-4.5),
         ssoiauta = (ssoicl1a*7.8) + (ssoicl2a*4.5) + (ssoicl3a*0) + (ssoicl4a*-4.5) + (ssoicl5a*-7.8) + (ssoicl6a*-4.5) + (ssoicl7a*0) + (ssoicl8a*4.5))



```

Summarize PANAS from Kayla
```{r panas subscales}
kayla_processed$panaspospre <-  kayla_processed$panas_p1 + kayla_processed$panas_p3 + kayla_processed$panas_p5 + kayla_processed$panas_p9 + kayla_processed$panas_p10 + kayla_processed$panas_p12 + kayla_processed$panas_p14 + kayla_processed$panas_p16 + kayla_processed$panas_p17+ kayla_processed$panas_p19

kayla_processed$panasnegpre <-  kayla_processed$panas_p2+  kayla_processed$panas_p4+  kayla_processed$panas_p6+  kayla_processed$panas_p7+  kayla_processed$panas_p8+  kayla_processed$panas_p11+  kayla_processed$panas_p13+  kayla_processed$panas_p15+  kayla_processed$panas_p18+  kayla_processed$panas_p20
 
kayla_processed$panasposafter <- kayla_processed$panas_a1 + kayla_processed$panas_a3 + kayla_processed$panas_a5 + kayla_processed$panas_a9 + kayla_processed$panas_a10 + kayla_processed$panas_a12 + kayla_processed$panas_a14 + kayla_processed$panas_a16 + kayla_processed$panas_a17 + kayla_processed$panas_a19
 
kayla_processed$panasnegafter <- kayla_processed$panas_a2+  kayla_processed$panas_a4+  kayla_processed$panas_a6+  kayla_processed$panas_a7+  kayla_processed$panas_a8+  kayla_processed$panas_a11+  kayla_processed$panas_a13+  kayla_processed$panas_a15+  kayla_processed$panas_a18+  kayla_processed$panas_a20
```

Calculate the Reliability for the PANAS.  You would need to install the package `fmsb`
```{r}
# Positive Affect Score - Prior
panaspospre.df <- kayla_tb[ , c("panas_p1", "panas_p3", "panas_p5", "panas_p9", "panas_p12", "panas_p14", "panas_p16", "panas_p17", "panas_p19")] 
CronbachAlpha(panaspospre.df) 
#.87

# Negative Affect Score Pior
panasnegpre.df <- kayla_tb[ , c("panas_p2", "panas_p4", "panas_p6", "panas_p7", "panas_p8", "panas_p11", "panas_p13", "panas_p15", "panas_p18", "panas_p20")] CronbachAlpha(panasnegpre.df) # doesn't work
#.87

# Positive Affect Score After
panasposafter.df <- kayla_tb[ , c("panas_a1", "panas_a3", "panas_a5", "panas_a9", "panas_a10", "panas_a12", "panas_a14", "panas_a16", "panas_a17", "panas_a19")] 
CronbachAlpha(panasposafter.df) # .80

## Negative Affect Score After
panasnegafter.df <- kayla_tb[ , c("panas_a2", "panas_a4", "panas_a6", "panas_a7", "panas_a8", "panas_a11", "panas_a13", "panas_a15", "panas_a18", "panas_a20")] 
CronbachAlpha(panasnegafter.df) # .87
```


### Add depressive versus stimulant category to data
```{r}

```





# Hypothesis Testing

## Hypothesis 1: Participants seeking treatment for substance abuse will report greater hoped-for affiliation in a reported significant-other relationship following use of their substance of choice compared to participants not seeking treatment for substance abuse. (Do not analyze drug of choice as stated in data analytic plan)

1a. Paired t-test and visualization for entire sample
```{r}
# 1. First, general paired t-tests for sostaff (sign other to subject transitive affiliation), ssotaff (subject to sign other transitive affiliation), sosiaff (sign other to subject intransitive affiliation), ssoiaff (subject to sign other intransitive affiliation)
library(widyr)


```


1b. Residual change and differences by experimental (substance) and control (nonubstance) groups
###### SSOI AUT POST - Hypothesis 1 & 3



3. Calculate Residuals from SASB Data SOSIAUT, SSOIAFF, SSOIAUT
```{r SOSIAUT RES, echo=FALSE}
# https://cran.r-project.org/web/packages/broom/vignettes/broom.html
dimensions <- kayla_processed %>%
  select(client_number, group, i_c, i_a, survey, gender, c(212:231))



fit1 <- lm(sostaffa ~ sostaffp, data = dimensions)

tidy(fit1)
#head(glance(fit))
resid1 <- augment(fit1)
resid.tb1 <- tbl_df(resid1)
resid.tb1 <- resid.tb1 %>% 
  select(.std.resid) %>%
  rename(sosiautzres = .std.resid)
```

```{r }
fit2 <- lm(sosiaffa ~ sosiaffp, data = dimensions)
#tidy(fit)
#head(glance(fit))
resid2 <- augment(fit2)
resid.tb2 <- tbl_df(resid2)
resid.tb2 <- resid.tb2 %>% 
  select(.std.resid) %>%
  rename(ssoiautzres = .std.resid)
`

```{r}

```



## Hypothesis 2: Adolescents who reported depressants (alcohol, marijuana, narcotics) as their drug of choice will rate their significant others as more sulking and resentful prior to using compared to adolescents who do not report depressants as their drug of choice. 
```{r}

```


## Hypothesis 3: Participants seeking treatment for substance abuse will report greater hoped-for introject (self-concept) affiliation following use of their substance of choice compared to participants not seeking treatment for substance abuse.
```{r}

```

## Hypothesis 4: Participants seeking treatment for substance abuse will report less negative affect following use of their substance of choice compared to participants not seeking treatment for substance abuse.
```{r}

```


## Hypothesis 5: Participants not seeking treatment for substance abuse will report greater positive affect following substance use compared to participants seeking treatment for substance abuse.
```{r}

```

## Hypothesis 6: Exploratory analyses will examine change in relationship and emotions associated with parental monitoring, peer acceptance, and diagnostic group.
```{r}

```



















