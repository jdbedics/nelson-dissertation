---
title: "Data Analysis for Kayla Nelson's Doctoral Dissertation"
author: "Kayla Nelson"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output:
  html_document:
    toc: yes
    toc_float: yes
  word_document:
    toc: yes
  pdf_document:
    toc: yes
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width = 5, fig.height = 5)
#knitr::opts_knit$set(root.dir=normalizePath('../'))
```


# Data Import and Wrangling

```{r load libraries}
library(httr)
library(tidyverse)
library(janitor)
library(broom)
library(tidyr)
library(fmsb) # contains ChronbachAlpha 
library(arm)
library(knitr)
library(kableExtra)
theme_set(theme_light())
```


```{r import data, eval=FALSE}
if (!file.exists('kayla.xlsx')) {
   data <- GET('osf.io/xnfg5//?action=download',
                write_disk('kayla.xlsx'))#, overwrite = TRUE))
}

 get data and clean
kayla.tb <- readxl::read_excel('kayla.xlsx')
kayla.tb <- kayla.tb %>%  
  clean_names()
 saved it as an .rds
saveRDS(kayla.tb, file = "kayla.rds")
```

```{r open data}
kayla_raw  <- read_rds("kayla.rds")
```

```{r create processed data}
# we rename introject first
kayla_processed <- kayla_raw %>%
  rename(intcl1b = sasb_1, 
         intcl2b = sasb_6,
         intcl3b = sasb_3,
         intcl4b = sasb_4,
         intcl5b = sasb_8,
         intcl6b = sasb_5,
         intcl7b = sasb_2,
         intcl8b = sasb_7,
         intcl1w = sasb_ia1,
         intcl2w = sasb_ia6,
         intcl3w = sasb_ia3,
         intcl4w = sasb_ia4,
         intcl5w = sasb_ia8,
         intcl6w = sasb_ia5,
         intcl7w = sasb_ia2,
         intcl8w = sasb_ia7,
  
     # renaming friend first 16 for pre      
         sostcl1p = sasb_fp14,
         sostcl2p = sasb_fp1,
         sostcl3p = sasb_fp6,
         sostcl4p = sasb_fp13,
         sostcl5p = sasb_fp9,
         sostcl6p = sasb_fp3,
         sostcl7p = sasb_fp12,
         sostcl8p = sasb_fp4,
         sosicl1p = sasb_fp11,
         sosicl2p = sasb_fp8,
         sosicl3p = sasb_fp15,
         sosicl4p = sasb_fp5,
         sosicl5p = sasb_fp10,
         sosicl6p = sasb_fp7,
         sosicl7p = sasb_fp16,
         sosicl8p = sasb_fp2,
    # renaming friend second 16 for pre
         ssotcl1p = sasb_fp30,
         ssotcl2p = sasb_fp17,
         ssotcl3p = sasb_fp22,
         ssotcl4p = sasb_fp29,
         ssotcl5p = sasb_fp25,
         ssotcl6p = sasb_fp19,
         ssotcl7p = sasb_fp28,
         ssotcl8p = sasb_fp20,
         ssoicl1p = sasb_fp27,
         ssoicl2p = sasb_fp24,
         ssoicl3p = sasb_fp31,
         ssoicl4p = sasb_fp21,
         ssoicl5p = sasb_fp26,
         ssoicl6p = sasb_fp23,
         ssoicl7p = sasb_fp32,
         ssoicl8p = sasb_fp18,
    
    # below is for after.  notice how the first sixteen and second sixteen are the same as above EXCEPT for the 'p' is now an 'a' 
    
        sostcl1a = sasb_fa14,
         sostcl2a = sasb_fa1,
         sostcl3a = sasb_fa6,
         sostcl4a = sasb_fa13,
         sostcl5a = sasb_fa9,
         sostcl6a = sasb_fa3,
         sostcl7a = sasb_fa12,
         sostcl8a = sasb_fa4,
         sosicl1a = sasb_fa11,
         sosicl2a = sasb_fa8,
         sosicl3a = sasb_fa15,
         sosicl4a = sasb_fa5,
         sosicl5a = sasb_fa10,
         sosicl6a = sasb_fa7,
         sosicl7a = sasb_fa16,
         sosicl8a = sasb_fa2,
    # second sixten for after     
         ssotcl1a = sasb_fa30,
         ssotcl2a = sasb_fa17,
         ssotcl3a = sasb_fa22,
         ssotcl4a = sasb_fa29,
         ssotcl5a = sasb_fa25,
         ssotcl6a = sasb_fa19,
         ssotcl7a = sasb_fa28,
         ssotcl8a = sasb_fa20,
         ssoicl1a = sasb_fa27,
         ssoicl2a = sasb_fa24,
         ssoicl3a = sasb_fa31,
         ssoicl4a = sasb_fa21,
         ssoicl5a = sasb_fa26,
         ssoicl6a = sasb_fa23,
         ssoicl7a = sasb_fa32,
         ssoicl8a = sasb_fa18,
    
     # renaming parent first 16 for pre 
    
         psostcl1p = sasb_pp14,
         psostcl2p = sasb_pp1,
         psostcl3p = sasb_pp6,
         psostcl4p = sasb_pp13,
         psostcl5p = sasb_pp9,
         psostcl6p = sasb_pp3,
         psostcl7p = sasb_pp12,
         psostcl8p = sasb_pp4,
         psosicl1p = sasb_pp11,
         psosicl2p = sasb_pp8,
         psosicl3p = sasb_pp15,
         psosicl4p = sasb_pp5,
         psosicl5p = sasb_pp10,
         psosicl6p = sasb_pp7,
         psosicl7p = sasb_pp16,
         psosicl8p = sasb_pp2,
    # renaming parent second 16 for pre
         pssotcl1p = sasb_pp30,
         pssotcl2p = sasb_pp17,
         pssotcl3p = sasb_pp22,
         pssotcl4p = sasb_pp29,
         pssotcl5p = sasb_pp25,
         pssotcl6p = sasb_pp19,
         pssotcl7p = sasb_pp28,
         pssotcl8p = sasb_pp20,
         pssoicl1p = sasb_pp27,
         pssoicl2p = sasb_pp24,
         pssoicl3p = sasb_pp31,
         pssoicl4p = sasb_pp21,
         pssoicl5p = sasb_pp26,
         pssoicl6p = sasb_pp23,
         pssoicl7p = sasb_pp32,
         pssoicl8p = sasb_pp18,
    
    # renaming parent first 16 for after
    
         psostcl1a = sasb_pa14,
         psostcl2a = sasb_pa1,
         psostcl3a = sasb_pa6,
         psostcl4a = sasb_pa13,
         psostcl5a = sasb_pa9,
         psostcl6a = sasb_pa3,
         psostcl7a = sasb_pa12,
         psostcl8a = sasb_pa4,
         psosicl1a = sasb_pa11,
         psosicl2a = sasb_pa8,
         psosicl3a = sasb_pa15,
         psosicl4a = sasb_pa5,
         psosicl5a = sasb_pa10,
         psosicl6a = sasb_pa7,
         psosicl7a = sasb_pa16,
         psosicl8a = sasb_pa2,
    
# second parent sixteen for after     
         pssotcl1a = sasb_pa30,
         pssotcl2a = sasb_pa17,
         pssotcl3a = sasb_pa22,
         pssotcl4a = sasb_pa29,
         pssotcl5a = sasb_pa25,
         pssotcl6a = sasb_pa19,
         pssotcl7a = sasb_pa28,
         pssotcl8a = sasb_pa20,
         pssoicl1a = sasb_pa27,
         pssoicl2a = sasb_pa24,
         pssoicl3a = sasb_pa31,
         pssoicl4a = sasb_pa21,
         pssoicl5a = sasb_pa26,
         pssoicl6a = sasb_pa23,
         pssoicl7a = sasb_pa32,
         pssoicl8a = sasb_pa18) %>%
  mutate(post_id = row_number())
```


```{r int weight}
###### 1. Introject
int <-  kayla_processed %>%
  mutate(surf_1_1 = (intcl1b*0) + (intcl2b*4.5) + (intcl3b*7.8) + (intcl4b*4.5) + (intcl5b*0) + (intcl6b*-4.5) + (intcl7b*-7.8) + (intcl8b*-4.5),
         surf_2_1 = (intcl1b*7.8) + (intcl2b*4.5) + (intcl3b*0) + (intcl4b*-4.5) + (intcl5b*-7.8) + (intcl6b*-4.5) + (intcl7b*0) + (intcl8b*4.5),
         surf_1_2 = (intcl1w*0) + (intcl2w*4.5) + (intcl3w*7.8) + (intcl4w*4.5) + (intcl5w*0) + (intcl6w*-4.5) + (intcl7w*-7.8) + (intcl8w*-4.5),
         surf_2_2 = (intcl1w*7.8) + (intcl2w*4.5) + (intcl3w*0) + (intcl4w*-4.5) + (intcl5w*-7.8) + (intcl6w*-4.5) + (intcl7w*0) + (intcl8w*4.5)) %>%
  dplyr::select(client_number, group, surf_1_1, surf_1_2, surf_2_1, surf_2_2)
```

```{r sost and sosi pre weight}
sosp <- kayla_processed %>%
  mutate(surf_3_1 = (sostcl1p*0) + (sostcl2p*4.5) + (sostcl3p*7.8) + (sostcl4p*4.5) + (sostcl5p*0) + (sostcl6p*-4.5) + (sostcl7p*-7.8) + (sostcl8p*-4.5),
         surf_4_1 = (sostcl1p*7.8) + (sostcl2p*4.5) + (sostcl3p*0) + (sostcl4p*-4.5) + (sostcl5p*-7.8) + (sostcl6p*-4.5) + (sostcl7p*0) + (sostcl8p*4.5),
         # significant other reacting to subjects - affiliation and pre and autonomy pre
         surf_5_1 = (sosicl1p*0) + (sosicl2p*4.5) + (sosicl3p*7.8) + (sosicl4p*4.5) + (sosicl5p*0) + (sosicl6p*-4.5) + (sosicl7p*-7.8) + (sosicl8p*-4.5),
         surf_6_1 = (sosicl1p*7.8) + (sosicl2p*4.5) + (sosicl3p*0) + (sosicl4p*-4.5) + (sosicl5p*-7.8) + (sosicl6p*-4.5) + (sosicl7p*0) + (sosicl8p*4.5)) %>%
  dplyr::select(client_number, surf_3_1, surf_4_1, surf_5_1, surf_6_1)
```

```{r ssot and ssoi pre weigth}
ssop <- kayla_processed %>%
  mutate(surf_7_1 = (ssotcl1p*0) + (ssotcl2p*4.5) + (ssotcl3p*7.8) + (ssotcl4p*4.5) + (ssotcl5p*0) + (ssotcl6p*-4.5) + (ssotcl7p*-7.8) + (sostcl8p*-4.5),
         surf_8_1 = (ssotcl1p*7.8) + (ssotcl2p*4.5) + (ssotcl3p*0) + (ssotcl4p*-4.5) + (ssotcl5p*-7.8) + (ssotcl6p*-4.5) + (ssotcl7p*0) + (ssotcl8p*4.5),
         # subject reacting towards significant other - affiliation pre and autonomy pre
        surf_9_1 = (ssoicl1p*0) + (ssoicl2p*4.5) + (ssoicl3p*7.8) + (ssoicl4p*4.5) + (ssoicl5p*0) + (ssoicl6p*-4.5) + (ssoicl7p*-7.8) + (sostcl8p*-4.5),
         surf_10_1 = (ssoicl1p*7.8) + (ssoicl2p*4.5) + (ssoicl3p*0) + (ssoicl4p*-4.5) + (ssoicl5p*-7.8) + (ssoicl6p*-4.5) + (ssoicl7p*0) + (ssoicl8p*4.5)) %>%
  dplyr::select(client_number, surf_7_1, surf_8_1, surf_9_1, surf_10_1)
```

```{r sost-sosi after weights}
sosa <- kayla_processed %>%
  mutate(surf_3_2 = (sostcl1a*0) + (sostcl2a*4.5) + (sostcl3a*7.8) + (sostcl4a*4.5) + (sostcl5a*0) + (sostcl6a*-4.5) + (sostcl7a*-7.8) + (sostcl8a*-4.5),
         surf_4_2 = (sostcl1a*7.8) + (sostcl2a*4.5) + (sostcl3a*0) + (sostcl4a*-4.5) + (sostcl5a*-7.8) + (sostcl6a*-4.5) + (sostcl7a*0) + (sostcl8a*4.5),
         # significant other reacting to subjects - affiliation and after and autonomy after
         surf_5_2 = (sosicl1a*0) + (sosicl2a*4.5) + (sosicl3a*7.8) + (sosicl4a*4.5) + (sosicl5a*0) + (sosicl6a*-4.5) + (sosicl7a*-7.8) + (sosicl8a*-4.5),
         surf_6_2 = (sosicl1a*7.8) + (sosicl2a*4.5) + (sosicl3a*0) + (sosicl4a*-4.5) + (sosicl5a*-7.8) + (sosicl6a*-4.5) + (sosicl7a*0) + (sosicl8a*4.5)) %>%
  dplyr::select(client_number, surf_3_2, surf_4_2, surf_5_2, surf_6_2)
```

```{r ssot-ssoi after}
ssoa <- kayla_processed %>%
  mutate(surf_7_2 = (ssotcl1a*0) + (ssotcl2a*4.5) + (ssotcl3a*7.8) + (ssotcl4a*4.5) + (ssotcl5a*0) + (ssotcl6a*-4.5) + (ssotcl7a*-7.8) + (sostcl8a*-4.5),
         surf_8_2 = (ssotcl1a*7.8) + (ssotcl2a*4.5) + (ssotcl3a*0) + (ssotcl4a*-4.5) + (ssotcl5a*-7.8) + (ssotcl6a*-4.5) + (ssotcl7a*0) + (ssotcl8a*4.5),
         # subject reacting towards significant other - affiliation after and autonomy after
        surf_9_2 = (ssoicl1a*0) + (ssoicl2a*4.5) + (ssoicl3a*7.8) + (ssoicl4a*4.5) + (ssoicl5a*0) + (ssoicl6a*-4.5) + (ssoicl7a*-7.8) + (sostcl8a*-4.5),
         surf_10_2 = (ssoicl1a*7.8) + (ssoicl2a*4.5) + (ssoicl3a*0) + (ssoicl4a*-4.5) + (ssoicl5a*-7.8) + (ssoicl6a*-4.5) + (ssoicl7a*0) + (ssoicl8a*4.5)) %>%
  dplyr::select(client_number, surf_7_2, surf_8_2, surf_9_2, surf_10_2)
```

```{r parents code}
psosp <- kayla_processed %>%
  mutate(surf_11_1 = (psostcl1p*0) + (psostcl2p*4.5) + (psostcl3p*7.8) + (psostcl4p*4.5) + (psostcl5p*0) + (psostcl6p*-4.5) + (psostcl7p*-7.8) + (psostcl8p*-4.5),
         surf_12_1 = (psostcl1p*7.8) + (psostcl2p*4.5) + (psostcl3p*0) + (psostcl4p*-4.5) + (psostcl5p*-7.8) + (psostcl6p*-4.5) + (psostcl7p*0) + (psostcl8p*4.5),
         # parent significant other reacting to subjects - affiliation and pre and autonomy pre
         surf_13_1 = (psosicl1p*0) + (psosicl2p*4.5) + (sosicl3p*7.8) + (sosicl4p*4.5) + (sosicl5p*0) + (sosicl6p*-4.5) + (sosicl7p*-7.8) + (sosicl8p*-4.5),
        surf_14_1 = (psosicl1p*7.8) + (psosicl2p*4.5) + (psosicl3p*0) + (psosicl4p*-4.5) + (psosicl5p*-7.8) + (psosicl6p*-4.5) + (psosicl7p*0) + (psosicl8p*4.5)) %>%
  dplyr::select(client_number, surf_11_1, surf_12_1, surf_13_1, surf_14_1)

# PSSOT-PSSOI PRE
pssop <- kayla_processed %>%
  mutate(surf_15_1 = (pssotcl1p*0) + (pssotcl2p*4.5) + (pssotcl3p*7.8) + (pssotcl4p*4.5) + (pssotcl5p*0) + (pssotcl6p*-4.5) + (pssotcl7p*-7.8) + (psostcl8p*-4.5),
         surf_16_1 = (pssotcl1p*7.8) + (pssotcl2p*4.5) + (pssotcl3p*0) + (pssotcl4p*-4.5) + (pssotcl5p*-7.8) + (pssotcl6p*-4.5) + (pssotcl7p*0) + (pssotcl8p*4.5),
         # subject reacting towards significant other (parent) - affiliation pre and autonomy pre
      surf_17_1 = (pssoicl1p*0) + (pssoicl2p*4.5) + (pssoicl3p*7.8) + (pssoicl4p*4.5) + (pssoicl5p*0) + (pssoicl6p*-4.5) + (pssoicl7p*-7.8) + (psostcl8p*-4.5),
         surf_18_1 = (pssoicl1p*7.8) + (pssoicl2p*4.5) + (pssoicl3p*0) + (pssoicl4p*-4.5) + (pssoicl5p*-7.8) + (pssoicl6p*-4.5) + (pssoicl7p*0) + (pssoicl8p*4.5)) %>%
  dplyr::select(client_number, surf_15_1, surf_16_1, surf_17_1, surf_18_1)


# PSOST-PSOSI After
psosa <- kayla_processed %>%
  mutate(surf_11_2 = (psostcl1a*0) + (psostcl2a*4.5) + (psostcl3a*7.8) + (psostcl4a*4.5) + (psostcl5a*0) + (psostcl6a*-4.5) + (psostcl7a*-7.8) + (psostcl8a*-4.5),
         surf_12_2 = (psostcl1a*7.8) + (psostcl2a*4.5) + (psostcl3a*0) + (psostcl4a*-4.5) + (psostcl5a*-7.8) + (psostcl6a*-4.5) + (psostcl7a*0) + (psostcl8a*4.5),
         # significant other (parent) reacting to subjects - affiliation and after and autonomy after
         surf_13_2 = (psosicl1a*0) + (psosicl2a*4.5) + (psosicl3a*7.8) + (psosicl4a*4.5) + (psosicl5a*0) + (psosicl6a*-4.5) + (psosicl7a*-7.8) + (psosicl8a*-4.5),
         surf_14_2 = (psosicl1a*7.8) + (psosicl2a*4.5) + (psosicl3a*0) + (psosicl4a*-4.5) + (psosicl5a*-7.8) + (psosicl6a*-4.5) + (psosicl7a*0) + (psosicl8a*4.5)) %>%
  dplyr::select(client_number, surf_11_2, surf_12_2, surf_13_2, surf_14_2)


# PSSOT-PSSOI After
pssoa <- kayla_processed %>%
  mutate(surf_15_2 = (pssotcl1a*0) + (pssotcl2a*4.5) + (pssotcl3a*7.8) + (pssotcl4a*4.5) + (pssotcl5a*0) + (pssotcl6a*-4.5) + (pssotcl7a*-7.8) + (psostcl8a*-4.5),
         surf_16_2 = (pssotcl1a*7.8) + (pssotcl2a*4.5) + (pssotcl3a*0) + (pssotcl4a*-4.5) + (pssotcl5a*-7.8) + (pssotcl6a*-4.5) + (pssotcl7a*0) + (pssotcl8a*4.5),
         # subject reacting towards significant other (parent) - affiliation after and autonomy after
        surf_17_2 = (pssoicl1a*0) + (pssoicl2a*4.5) + (pssoicl3a*7.8) + (pssoicl4a*4.5) + (pssoicl5a*0) + (pssoicl6a*-4.5) + (pssoicl7a*-7.8) + (psostcl8a*-4.5),
         surf_18_2 = (pssoicl1a*7.8) + (pssoicl2a*4.5) + (pssoicl3a*0) + (pssoicl4a*-4.5) + (pssoicl5a*-7.8) + (pssoicl6a*-4.5) + (pssoicl7a*0) + (pssoicl8a*4.5)) %>%
  dplyr::select(client_number, surf_15_2, surf_16_2, surf_17_2, surf_18_2)
```


```{r SASB weights Long Format}
# Create trimmed down coefficient table that does not include parents.
coefficients <- bind_cols(int, sosp, ssop, sosa, ssoa) %>% 
  dplyr::select(-client_number1, -client_number2, -client_number3, -client_number4)# %>%
  #mutate(post_id = row_number())

# Create long file to do multiple t-tests.
coefficents_long <- coefficients %>%
  gather(key, value, -client_number, -group) %>% 
  extract(key, c("surface", "state"), "(surf\\_.*)\\_(.)") %>%
  spread(state, value) %>%
  #clean_names() %>%
  rename(pre = `1`,
         post = `2`) %>%
  mutate(surface = factor(surface, levels = c("surf_1", "surf_2", "surf_3", "surf_4", "surf_5", "surf_6", "surf_7", "surf_8", "surf_9", "surf_10")),
         group_type = factor(group, labels = c("Non-Substance", "Substance Use")),
         group_type = factor(group_type, levels = c("Substance Use", "Non-Substance")))
```


```{r summarize panas subscales}
kayla_processed$panas1_1 <-  kayla_processed$panas_p1 + kayla_processed$panas_p3 + kayla_processed$panas_p5 + kayla_processed$panas_p9 + kayla_processed$panas_p10 + kayla_processed$panas_p12 + kayla_processed$panas_p14 + kayla_processed$panas_p16 + kayla_processed$panas_p17+ kayla_processed$panas_p19

kayla_processed$panas2_1 <-  kayla_processed$panas_p2+  kayla_processed$panas_p4+  kayla_processed$panas_p6+  kayla_processed$panas_p7+  kayla_processed$panas_p8+  kayla_processed$panas_p11+  kayla_processed$panas_p13+  kayla_processed$panas_p15+  kayla_processed$panas_p18+  kayla_processed$panas_p20
 
kayla_processed$panas1_2 <- kayla_processed$panas_a1 + kayla_processed$panas_a3 + kayla_processed$panas_a5 + kayla_processed$panas_a9 + kayla_processed$panas_a10 + kayla_processed$panas_a12 + kayla_processed$panas_a14 + kayla_processed$panas_a16 + kayla_processed$panas_a17 + kayla_processed$panas_a19
 
kayla_processed$panas2_2 <- kayla_processed$panas_a2+  kayla_processed$panas_a4+  kayla_processed$panas_a6+  kayla_processed$panas_a7+  kayla_processed$panas_a8+  kayla_processed$panas_a11+  kayla_processed$panas_a13+  kayla_processed$panas_a15+  kayla_processed$panas_a18+  kayla_processed$panas_a20
```


```{r Reliability, include=FALSE, eval=FALSE}
# Positive Affect Score - Prior
panaspospre.df <- kayla_processed[ , c("panas_p1", "panas_p3", "panas_p5", "panas_p9", "panas_p12", "panas_p14", "panas_p16", "panas_p17", "panas_p19")] 
CronbachAlpha(panaspospre.df) 
#.87

# Negative Affect Score Pior
panasnegpre.df <- kayla_processed[ , c("panas_p2", "panas_p4", "panas_p6", "panas_p7", "panas_p8", "panas_p11", "panas_p13", "panas_p15", "panas_p18", "panas_p20")] 
CronbachAlpha(panasnegpre.df) # doesn't work
#.87

# Positive Affect Score After
panasposafter.df <- kayla_processed[ , c("panas_a1", "panas_a3", "panas_a5", "panas_a9", "panas_a10", "panas_a12", "panas_a14", "panas_a16", "panas_a17", "panas_a19")] 
CronbachAlpha(panasposafter.df) # .80

## Negative Affect Score After
panasnegafter.df <- kayla_processed[ , c("panas_a2", "panas_a4", "panas_a6", "panas_a7", "panas_a8", "panas_a11", "panas_a13", "panas_a15", "panas_a18", "panas_a20")] 
CronbachAlpha(panasnegafter.df) # .87


## Rest of Reliabilities

```


# Descriptive Statistics for SASB Surfaces

```{r descriptive stats}
coefficents_long %>%
  group_by(group_type, surface) %>%
  summarise(pre_mean = mean(pre, na.rm=TRUE),
            post_mean = mean(post, na.rm=TRUE),
            pre_sd = sd(pre, na.rm=TRUE),
            pos_sd = sd(post, na.rm=TRUE),
            pre_min = min(pre, na.rm=TRUE),
            pre_max = max(pre, na.rm=TRUE),
            post_min = min(post, na.rm=TRUE),
            post_max = max(post, na.rm=TRUE)) %>%
  kable() %>%
  kable_styling(latex_options="scale_down")
```

Key: surf_1	= INTAFF; surf_2	= INTAUT; surf_3 = SOSTAFF; surf_4 = SOSTAUT; surf_5 = SOSIAFF; surf_6 = SOSIAUT; surf_7 = SSOTAFF; surf_8 = SSOTAUT; surf_9 = SSOIAFF; surf_10 = SSOIAUT.

\break

# Hypothesis 1

H1: Participants seeking treatment for substance abuse will report greater hoped-for affiliation in a reported significant-other relationship following use of their substance of choice compared to participants not seeking treatment for substance abuse. 

1. Boxplot for Affiliation Scores by Group at Pre- and Post-Substance Use. 
2. Independent T-tests for H1.
3. Assumptions for H1.

## 1. Boxplot for H1

```{r h1-data-boxplot}
h1_box <- coefficents_long %>%
  filter(surface == "surf_3" | surface == "surf_5" | surface == "surf_7" | surface == "surf_9") %>%
  dplyr::select(-group) %>%
  gather(time, value, -group_type,-client_number, -surface) %>%
  mutate(affiliation = as.numeric(value),
         time_f = as.factor(time),
         time_f = factor(time_f, levels = c("pre","post")),
         sasb_surface = factor(surface, labels = c("SOST", "SOSI", "SSOT", "SSOI")),
         sasb_surface = factor(sasb_surface, levels = c("SOST", "SOSI", "SSOT", "SSOI"))) %>%
  dplyr::select(client_number, sasb_surface, time_f, group_type, affiliation, -value, -time)
```

```{r fig-1-h1-boxplot}
h1_box %>%
  ggplot(aes(time_f, affiliation, color=group_type)) +
  geom_boxplot(aes(color=group_type)) +
  facet_wrap(~sasb_surface) + 
  guides(color=guide_legend(title="Group")) +
  labs(x = "Time",
       y = "SASB Affiliation",
       title = "Figure 1. Boxplots of SASB Affiliation by Interpersonal Surfaces \nand Group Pre and Post Substance Use",
       caption = "Note. SOST = Significant Other to Subject Transitive; SOSI = Significant Other to Subject Intransitive; \nSSOT = Subject to Significant Other Transitive; SSOI = Subject to Significant Other Intransitive") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0))
```


## 2. Independent T-Tests for H1


```{r h1-residuals}
# https://cran.r-project.org/web/packages/broom/vignettes/broom.html
coeff_model <- coefficents_long %>%
  nest(-surface) %>%  
  mutate(
    fit = map(data, ~ lm(post ~ pre, data = .x)),  # S3 list-col
    tidied = map(fit, tidy),
    glanced = map(fit, glance),
    augmented = map(fit, augment)
  )

#coeff_model %>% unnest(glanced, .drop = TRUE)
sasb_residuals_noid <- coeff_model %>% 
  unnest(augmented) %>% 
  dplyr::select(surface, .rownames, .std.resid) %>%
  spread(surface, .std.resid) %>%
  rename(post_id = .rownames) %>%
  mutate(post_id = as.numeric(post_id)) %>%
  arrange(post_id)
 
# need to add 
coef_group <- coefficients %>%
  mutate(post_id = row_number()) %>%
  dplyr::select(client_number, post_id, everything())
 
sasb_residuals <- bind_cols(sasb_residuals_noid, coef_group) %>%
  dplyr::select(post_id, group, 2:11)
```



```{r h1-tests}
h1_t_tests <- sasb_residuals %>%
  gather(surface, value, -post_id, -group) %>%
  nest(-surface) %>%
  mutate(
    fit = map(data, ~ t.test(value ~ group, data = .x, paired=FALSE)),  # S3 list-col
    tidied = map(fit, tidy))

#test$data[[1]]

h1_t_tests %>%
  unnest(tidied) %>%
  dplyr::select(surface, statistic, p.value, parameter, conf.low, conf.high) %>%
  filter(surface == "surf_3" | surface == "surf_5" | surface == "surf_7" | surface == "surf_9") %>%
  mutate(surface = factor(surface, levels = c("surf_3", "surf_5", "surf_7", "surf_9")),
         sasb_surface = factor(surface, labels = c("SOST", "SOSI", "SSOT", "SSOI")),
         sasb_surface = factor(sasb_surface, levels = c("SOST", "SOSI", "SSOT", "SSOI"))) %>%
  kable()
```  

## 3. Assumptions for H1

a) Shapiro Test for H1
```{r h1-shapiro}
shapiro.test(sasb_residuals$surf_3)
shapiro.test(sasb_residuals$surf_5)
shapiro.test(sasb_residuals$surf_7)
shapiro.test(sasb_residuals$surf_9)
```

b) Levene's Test for H1
```{r h1-levene}
car::leveneTest(sasb_residuals$surf_3, sasb_residuals$group)
car::leveneTest(sasb_residuals$surf_5, sasb_residuals$group)
car::leveneTest(sasb_residuals$surf_7, sasb_residuals$group)
car::leveneTest(sasb_residuals$surf_9, sasb_residuals$group)
```




\break

# Hypothesis 2

H2: Adolescents who reported depressantsas their drug of choice will rate their significant others as more sulking and resentful prior to using compared to adolescents who do not report depressants as their drug of choice. 

1. Boxplot for SASB Items "Sulk and Scurry by Drug of Choice.
2. Independent T-Test for H2.
3. Means and Standard Deviations for H2.
4. Assumptions for H2. 

## 1. Boxplot for H2

```{r h2-data}
h2_data <- kayla_processed %>%
  dplyr::select(sosicl6p, sosicl6a, doc1) %>%
    mutate(doc_f = if_else(doc1 %in% 1:4, "depressant", "stimulant")) %>%
  dplyr::select(-doc1)
```

```{r h2-data-boxplot}
h2_box <- h2_data %>%
  gather(time, value, -doc_f) %>%
  mutate(time_f = as.factor(time),
         time_f = factor(time_f, labels = c("post","pre")),
         time_f = factor(time_f, levels = c("pre","post")),)
```

```{r fig2-h2-boxplot}
h2_box %>%
  ggplot(aes(time_f, value)) +
  geom_boxplot(aes(color=doc_f)) +
  #geom_point(aes(color=group_type))+
  #facet_wrap(~sasb_surface) + 
  guides(color=guide_legend(title="Group")) +
  labs(x = "Time",
       y = "Sulk and Scurry",
       title = "Figure 2. Boxplots of SASB Cluster 6 Significant Other Sulks and Scurrys \nand Drug Type Pre and Post Substance Use",
       caption = "") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0)) +
  geom_jitter()
```

## 2. Independent T-test for H2
```{r h2-test-data}
h2_data_na <- h2_data %>% 
  filter(!is.na(sosicl6p)) %>%
  mutate(doc_fa = as.factor((doc_f)),
         num_6 = as.integer(sosicl6p))
```

```{r h2-test}
#t.test(h2_data_na$sosicl6p ~ h2_data_na$doc_fa) # pre
# data was not normally distributed.
wilcox.test(h2_data_na$sosicl6p ~ h2_data_na$doc_fa)
```

## 3. Means and SD for H2
```{r means-sd-h2}
h2_data_na %>%
  group_by(doc_fa) %>%
  summarize(mean = mean(sosicl6p),
            sd = sd(sosicl6p))
```

## 4. Assumptions for h2
a) Shapiro for H2
```{r h2-shapiro}
shapiro.test(h2_data_na$sosicl6p) # violate so we'll use non-parametric
hist(h2_data_na$sosicl6p)
#h2a <- h2_data_na %>% 
#  mutate(log = sqrt(sosicl6p))# %>%
  #ggplot(aes(log)) +
  #geom_histogram()
```

b) Levene's Test for H2
```{r h2-levene}
#Levene's test for comparison of variances of exam scores in the two universities.
car::leveneTest(h2_data_na$sosicl6p, h2_data_na$doc_fa) #ok
```




\break

# Hypothesis 3 

H3: Participants seeking treatment for substance abuse will report greater hoped-for introject (self-concept) affiliation following use of their substance of choice compared to participants not seeking treatment for substance abuse.

Analyses are almost identical to H1 but with the introject affiliation surface, surface 1. The analyses include the following:

1. Boxplot for introject affiliation differences between treatment groups pre- and post-substance use.
2. Independent t-test examining difference in residual change in introject affiliation between treatment groups.
3. Assumptions for H3.

## 1. Boxplot for H3
```{r h3-data-boxplot}
h3_box <- coefficents_long %>%
  filter(surface == "surf_1") %>%
  dplyr::select(-group) %>%
  gather(time, value, -group_type,-client_number, -surface) %>%
  mutate(affiliation = as.numeric(value),
         time_f = as.factor(time),
         time_f = factor(time_f, levels = c("pre","post")),
         sasb_surface = factor(surface, labels = c("int-aff")),
         sasb_surface = factor(sasb_surface, levels = c("int-aff"))) %>%
  dplyr::select(client_number, sasb_surface, time_f, group_type, affiliation, -value, -time)
```

```{r fig3-h3-boxplot}
h3_box %>%
  ggplot(aes(time_f, affiliation)) +
  geom_boxplot(aes(color=group_type)) +
  #geom_point(aes(color=group_type))+
  #facet_wrap(~sasb_surface) + 
  guides(color=guide_legend(title="Group")) +
  labs(x = "Time",
       y = "SASB Introject Affiliation",
       title = "Figure 3. Boxplot of SASB Introject Affiliation by Treatment Group  and Pre- and Post-Substance Use",
       caption = "") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0))
```

## 2. Independent T-Test for H3
```{r h3-test-data}
h3_final <- h1_t_tests %>%
  unnest(tidied) %>%
  dplyr::select(surface, statistic, p.value, parameter, conf.low, conf.high) %>%
  filter(surface == "surf_1") %>%
  mutate(surface = factor(surface, levels = c("surf_1")),
         sasb_surface = factor(surface, labels = c("int-aff")),
         sasb_surface = factor(sasb_surface, levels = c("int-aff")))
```  

```{r h3-test}
h3_final %>%
  knitr::kable()
```


## 3. Assumptions for H3

a) Shapiro for H3
```{r h3-shapiro}
shapiro.test(sasb_residuals$surf_1) #ok
```

b) Levene's Test for H3
```{r h3-levene}
car::leveneTest(sasb_residuals$surf_1, sasb_residuals$group) #ok
```



\break

# Hypothesis 4

H4: Participants seeking treatment for substance abuse will report less negative affect following use of their substance of choice compared to participants not seeking treatment for substance abuse.

1. Summary Statistics for H4 and H5 including PANAS Positive and Negative Affect Prior and Post-Substance Use
2. Boxplot for Change in PANAS Negative Affect by Treatment Group
3. Independent t-test for Residual Change in PANAS Negative Affect by Treatment group
4. Three Supplmental Paired t-tests for difference in PANAS Negative Affect 
  a) Overall Change in PANAS Negative Affect
  b) Change in PANAS Negative Affect for Substance-Use Group Only
  c) Change in PANAS Negative Affect for Non-Substance-Use Group Only
5. Assumptions for H4

## 1. Summary PANAS Statistics for H4 and H5


```{r wrangle-panas-data}
# 1. Make a smaller version of data focused on PANAS
panas_data <- kayla_processed %>% dplyr::select(client_number, group, panas1_1, panas1_2, panas2_1, panas2_2, pm_1, pm_2, pm_3, psm_1, psm_2, psm_3)  %>%
  mutate(group_type = factor(group, labels = c("Non-Substance", "Substance Use")))#,
         #group_type = factor(group_type, levels = c("Substance", "Non-Substance")))

# 2. calculate positive residual change
panas1_fit <- lm(panas1_2 ~ panas1_1, data = panas_data)
resid1 <- augment(panas1_fit)
  
resid1_2 <- resid1 %>%
  dplyr::select(.std.resid) %>%
  rename(panas1_res = .std.resid)

# calculate negative residual change
panas2_fit <- lm(panas2_2 ~ panas2_1, data = panas_data)
resid2 <- augment(panas2_fit)
  
resid2_2 <- resid2 %>%
  dplyr::select(.std.resid) %>%
  rename(panas2_res = .std.resid)

#create a data file with residuals added 
panas_processed <- panas_data %>% bind_cols(resid1_2, resid2_2)
```

a) Mean and Standard Deviations by Group for PANAS Pre and Post
```{r mean-sd-panas}
panas_data %>%
  group_by(group) %>%
  summarise(pos_pre_mean = mean(panas1_1),
            pos_post_mean = mean(panas1_2),
            neg_pre_mean = mean(panas2_1),
            neg_post_mean = mean(panas2_2),
            pos_pre_sd = sd(panas1_1),
            pos_pos_sd = sd(panas1_2),
            neg_pre_sd = sd(panas2_1),
            neg_post_sd = sd(panas2_2)) %>%
  knitr::kable() %>%
  kable_styling(latex_options="scale_down")
```

b) Minimum and Maxiumum by Group for PANAS Pre and Post
```{r, min-max-panas}
panas_data %>%
  group_by(group) %>%
  summarise(pos_pre_min = min(panas1_1),
            pos_pos_min = min(panas1_2),
            neg_pre_min = min(panas2_1),
            neg_post_min = min(panas2_2),
            pos_pre_max = max(panas1_1),
            pos_pos_max = max(panas1_2),
            neg_pre_max = max(panas2_1),
            neg_post_max = max(panas2_2)) %>%
  knitr::kable() %>%
  kable_styling(latex_options="scale_down")
```


## 2. Boxplot for H4
```{r fig4-h4-boxplot}
panas_data %>% 
  gather(panas_negative, score, panas2_1, panas2_2, -client_number) %>%
    mutate(panas_negative = factor(panas_negative, labels = c("Pre", "Post"))) %>%
  ggplot(aes(x=panas_negative, y=score)) +
  geom_boxplot() +
  geom_jitter(aes(color=panas_negative), size=2) +
  facet_wrap(~ group_type) +
  scale_color_manual(values=c("#12100F", "#60B2FF"), name="Negative Affect") +
  labs(x="Negative Affect",
       title = "Figure 4. Change in Negative Affect (PANAS) Prior and After Substance Use") +
  theme(legend.position = "none")
```





## 3. Independent T-Test for H4
```{r h4-test}
t.test(panas_processed$panas2_res ~ panas_processed$group, paired=FALSE)
```


## 4. Supplemental Paired T-tests for H4

a) Overall Difference in Negative Affect between Substance Use and Non-Substance Use Participants
```{r h4-supplemental-test-1}
t.test(panas_data$panas2_2, panas_data$panas2_1, paired = TRUE, alternative = "two.sided")
```
The difference in negative affect change following substance use was non-significant between substance and non-substance use participants (t(30)=-1.77, p=0.09)

b) Paired t-test for change in negative affect using Substance Use Group Only
```{r h4-supplemental-test-2}
su <- panas_data %>%
  filter(group_type == "Substance Use")

t.test(su$panas2_2, su$panas2_1, paired = TRUE, alternative = "two.sided")
# substance use people had a significant reduction (again, just change isn't different from nongroup)
```
Substance use participants showed a significant decrease in negative affect following substance use (t(19)=-2.16, p=0.04)

c) Paired t-test for change in negative affect using Non-Substance Use Group Only
```{r h4-supplemental-test-3}
nsu <- panas_data %>%
  filter(group_type == "Non-Substance")

t.test(nsu$panas2_2, nsu$panas2_1, paired = TRUE, alternative = "two.sided")
# non-substance use people had a non-significant reduction 
```
Non-substance use participants did not show a significant decrease in negative affect following substance use (t(10)=-0.11, p=0.91)

## 5. Assumptions for H4
a) Shapiro for H4
```{r h4-shapiro}
shapiro.test(panas_processed$panas2_res) #ok
```
b) Levene's for H4
```{r h4-levene}
car::leveneTest(panas_processed$panas2_res, panas_processed$group_type) #ok
```



\break

# Hypothesis 5

Hypothesis 5: Participants not seeking treatment for substance abuse will report greater positive affect following substance use compared to participants seeking treatment for substance abuse.

1. Boxplot for Change in Positive Affect by Treatment Group
2. Independent t-test for Residual Change in PANAS Positive Affect by Treatment group
3. Three Supplmental Paired t-tests for difference in PANAS Positive Affect 
  a) Overall Change in PANAS Positive Affect
  b) Change in PANAS Positive Affect for Substance-Use Group Only
  c) Change in PANAS Positive Affect for Non-Substance-Use Group Only
4. Assumptions for H5

## 1. Boxplot for H5
```{r fig5-h5-boxplot}
panas_data %>% 
  gather(panas_positive, score, panas1_1, panas1_2, -client_number) %>%
    mutate(panas_positive = factor(panas_positive, labels = c("Pre", "Post"))) %>%
  ggplot(aes(x=panas_positive, y=score)) +
  geom_boxplot() +
  geom_jitter(aes(color=panas_positive), size=2) +
  facet_wrap(~ group_type) +
  scale_color_manual(values=c("#12100F", "#60B2FF"), name="Positive Affect") +
  labs(x="Positive",
       title = "Figure 5. Change in Positive Affect (PANAS) Prior and After Substance Use") +
  theme(legend.position = "none")
```

## 2. Independent T-Test for H5
```{r h5-test}
t.test(panas_processed$panas1_res ~ panas_processed$group, paired=FALSE)
```

## 3. Supplemental Paired T-tests for H5

a) Overall Difference in Positive Affect between Substance Use and Non-Substance Use Participants
```{r h5-supplemental-test-1}
t.test(panas_data$panas1_2, panas_data$panas1_1, paired = TRUE, alternative = "two.sided")
```
The difference in positive affect change following substance use was non-significant between substance and non-substance use participants (t(30)=-1.02, p=0.32)

b) Paired t-test for change in positive affect using Substance Use Group Only
```{r h5-supplemental-test-2}
su <- panas_data %>%
  filter(group_type == "Substance Use")

t.test(su$panas1_2, su$panas1_1, paired = TRUE, alternative = "two.sided")
```
Substance use participants showed a non-significant change in positive affect following substance use (t(19)=1.03, p=0.32)

c) Paired t-test for change in positive affect using Non-Substance Use Group Only
```{r h5-supplemental-test-3}
nsu <- panas_data %>%
  filter(group_type == "Non-Substance")

t.test(nsu$panas1_2, nsu$panas1_1, paired = TRUE, alternative = "two.sided")
```
Non-substance use participants showed a non-significant change in positive affect following substance use (t(10)=-0.33, p=0.75)

## 4. Assumptions for H5

```{r h5-shapiro}
shapiro.test(panas_processed$panas1_res) #ok
```

```{r h5-levene}
car::leveneTest(panas_processed$panas1_res, panas_processed$group_type) #ok
```



\break

# Hypothesis 6 

Three exploratory analyses examined change in relationship and emotions following substance use as they are associated with parental monitoring, peer acceptance, and diagnostic group.  Due to no variability in diagnostic group, questions regarding diagnostic group were dropped.  Three questions examined were as follows:

1. H6-1: Higher levels of parental monitoring would be associated with a decrease in negative affect following substance use.
  a) Scatterplot of Parental Monitoring and Change in PANAS (Negative and Positive Affect) regardless of treatment group
  b) H6-1 Pearson Correlation Coefficients
  c) H6-1 Assumptions
2. H6-2: Higher levels of peer acceptance would be associated with an increase in positive affect substance use.
  a) Scatterplot of Peer Support and Change in PANAS (Negative and Positive Affect) regardless of treatment group
  b) H6-2 Pearson Correlation Coefficients
  c) H6-2 Assumptions
3. H6-3: Higher levels of peer acceptance would be associated with an increase in perceived affiliation in the actions of a significant other towards the participant following substance use.
  a) H6-3 Scatterplot of Peer Support and change in perception of Significant Other acting towards Participant with Affiliation following substance use
  b) H6-3 Pearson Correlation Coefficient

## 1. H6-1
```{r h6-wrangling}
panas_processed$pm_1r <- car::recode(panas_processed$pm_1, "1=4;  2=3;  3=2; 4=1")
panas_processed$pm_2r <- car::recode(panas_processed$pm_2, "1=4;  2=3;  3=2; 4=1")
panas_processed$pm_3r <- car::recode(panas_processed$pm_3, "1=4;  2=3;  3=2; 4=1")
panas_processed$psm_1r <- car::recode(panas_processed$psm_1, "1=4;  2=3;  3=2; 4=1")
panas_processed$psm_2r <- car::recode(panas_processed$psm_2, "1=4;  2=3;  3=2; 4=1")
panas_processed$psm_3r <- car::recode(panas_processed$psm_3, "1=4;  2=3;  3=2; 4=1")

h6_data <- panas_processed %>%
  group_by(client_number) %>%
  mutate(pmtot = sum(pm_1r + pm_2r + pm_3r),
         psmtot = sum(psm_1r + psm_2r + psm_3r)) %>%
  ungroup() %>%
  dplyr::select(panas2_res, panas1_res, pmtot, psmtot) 
```


a) H6-1 Scatterplot
```{r h61-box-data}
h3_box <- coefficents_long %>%
  filter(surface == "surf_1") %>%
  dplyr::select(-group) %>%
  gather(time, value, -group_type,-client_number, -surface) %>%
  mutate(affiliation = as.numeric(value),
         time_f = as.factor(time),
         time_f = factor(time_f, levels = c("pre","post")),
         sasb_surface = factor(surface, labels = c("int-aff")),
         sasb_surface = factor(sasb_surface, levels = c("int-aff"))) %>%
  dplyr::select(client_number, sasb_surface, time_f, group_type, affiliation, -value, -time)
```

```{r h61-boxplot}
h6_data %>%
  gather(panas_type, panas_value, -pmtot, -psmtot) %>%
  mutate(panas_f = factor(panas_type, labels = c("Positive", "Negative"))) %>%
  ggplot(aes(panas_value, pmtot, color = panas_f)) +
  geom_point() +
  stat_smooth(method = "lm") +
  guides(color=guide_legend(title="PANAS Type")) +
  labs(x = "Residual Change in PANAS",
       y = "Parental Monitoring Total",
       title = "Figure 6. Scatter plot of parental monitor \n by change in positive and negative PANAS",
       caption = "") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0))
```

b) H6-1 Pearson Correlation Coefficients
```{r h61-correlations}
cor.test(h6_data$panas2_res, h6_data$pmtot) # negative correlation - basically 0.0 - ns
cor.test(h6_data$panas1_res, h6_data$pmtot) # this was extra  just for the comparison.
```

C) H6-1 Assumptions
```{r h61-shapiro}
shapiro.test(h6_data$pmtot)
```

```{r h61-histogram}
hist(h6_data$pmtot)
```

## 2. H6-2 

a) H6-2 Scatterplot
```{r h62-scatterplot}
h6_data %>%
  gather(panas_type, panas_value, -pmtot, -psmtot) %>%
  mutate(panas_f = factor(panas_type, labels = c("Positive", "Negative"))) %>%
  ggplot(aes(panas_value, psmtot, color = panas_f)) +
  geom_point() +
  stat_smooth(method = "lm") +
  guides(color=guide_legend(title="PANAS Type")) +
  labs(x = "Residual Change in PANAS",
       y = "Peer Support Total",
       title = "Figure 7. Scatter plot of peer support \nby change in positive and negative PANAS",
       caption = "") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0))
```

b) H6-2 Pearson Correlation Coefficients
```{r h62-correlations}
cor.test(h6_data$panas2_res, h6_data$psmtot)
cor.test(h6_data$panas1_res, h6_data$psmtot) # positive correlation but not significant
```

C) H6-2 Assumptions
```{r h62-shapiro}
shapiro.test(h6_data$psmtot)
```

```{r h62-histogram}
hist(h6_data$psmtot)
```


## 3. H6-3
```{r h63-wrangling}
h63_data <- h6_data %>%
  dplyr::select(pmtot, psmtot) %>%
  bind_cols(sasb_residuals)
```

a) H6-3 Scatterplot
```{r h63-scatterplot}
h63_data %>%
  ggplot(aes(surf_5, psmtot)) +
  geom_point() +
  stat_smooth(method = "lm") +
  labs(x = "Residual Change in SOST AFF",
       y = "Peer Support Total",
       title = "Figure 8. Scatter plot of peer support \nby change in SOST AFF",
       caption = "Note. SOST = Significant Other to Subject - Affiliation") +
  scale_color_manual(values=c("#AAAAAA", "#60B2FF")) +
  theme(plot.caption = element_text(hjust = 0))
```

b) H6-3 Pearson Correlation Coefficient
```{r}
cor.test(h63_data$surf_5, h63_data$psmtot) # n.s 
```





```{r everyting after here is scratch, include=FALSE, echo=FALSE}
knitr::knit_exit()
```


```{r h4-visualization}
panas_processed %>%
  gather(time, panas_score, panas1_1, panas1_2, -client_number) %>%
  ggplot(aes(x=time, y=panas_score, color=group)) +
  #geom_jitter(aes(color=group)) +
  stat_summary(fun.y = mean, geom = "point", aes(group=group), position = position_dodge(width=.90)) + 
  #stat_summary(fun.y = mean, geom = "line", aes(group= group), position = position_dodge(width=.90)) + 
  stat_summary(fun.data = mean_cl_boot, geom = "errorbar", width = 0.2, aes(group=group), position = position_dodge(width=.90)) +
  scale_color_manual(values=c("#12100F", "#60B2FF"))
```


```{r, echo=FALSE, include=FALSE}
knit_exit()
```

## Extra Code

### H1 Not Included
```{r interpersonal surface tests, echo=FALSE, include=FALSE}
# Paired T-test for pre and post difference scores in affiliation for all surfaces and all groups - not comparing groups - and for interpersonal surfaces. Not included.

coefficents_long %>%
  filter(surface == "surf_3" | surface == "surf_5" | surface == "surf_7" | surface == "surf_9") %>%
  group_by(surface, group) %>%
  do(tidy(t.test(.$pre, .$post, paired=TRUE)))  
```


```{r simple paired t-tests, include=FALSE, echo=FALSE, eval=FALSE}
# Not included. 
# Surface 3
coefficients %>%
  group_by(group) %>%
  summarize(statistic = t.test(unlist(surf_3_1), unlist(surf_3_2), paired = TRUE)$statistic,
            p_value = t.test(unlist(surf_3_1), unlist(surf_3_2), paired = TRUE)$p.value)
# Surface 5 
coefficients %>%
  group_by(group) %>%
  summarize(statistic = t.test(unlist(surf_5_1), unlist(surf_5_2), paired = TRUE)$statistic,
            p_value = t.test(unlist(surf_5_1), unlist(surf_5_2), paired = TRUE)$p.value)

# Surface 7
coefficients %>%
  group_by(group) %>%
  summarize(statistic = t.test(unlist(surf_7_1), unlist(surf_7_2), paired = TRUE)$statistic,
            p_value = t.test(unlist(surf_7_1), unlist(surf_7_2), paired = TRUE)$p.value)

# Surface 9
coefficients %>%
  group_by(group) %>%
  summarize(statistic = t.test(unlist(surf_9_1), unlist(surf_9_2), paired = TRUE)$statistic,
            p_value = t.test(unlist(surf_9_1), unlist(surf_9_2), paired = TRUE)$p.value)
```


```{r graph h1 t-tests, echo=FALSE, eval=FALSE, include=FALSE}  
# not included
  h1_final %>%
  ggplot(aes(statistic, sasb_surface)) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low,
                     xmax = conf.high)) +
  labs(y = "SASB Surface",
       x = "T Statistic",
       title = "Independent T-Tests Comparing Differences in Residual Change \non SASB Interpersonal Surfaces for Affiliation for Pre- and Post-Substance Use (95% CI)",
       caption = "Note. SOST = Significant Other to Subject Transitive; SOSI = Significant Other to Subject Intransitive; SSOT = Subject to Significant Other Transitive; \nSSOI = Subject to Significant Other Intransitive; Dashed lines indicate +/- 1.96 T-Value") +
  coord_flip() +
  xlim(2,-2) +
  geom_vline(xintercept = 1.96, linetype="dashed") +
  geom_vline(xintercept = -1.96, linetype="dashed") +
  theme(plot.caption = element_text(hjust = 0))

####################### code to calculate individual residuals ##############
#fit1 <- lm(surf_1_2 ~ surf_1_1, data = coefficients)
#tidy(fit1)
#head(glance(fit))
#resid1 <- augment(fit1)
#resid.tb1 <- tbl_df(resid1)
#int.tb <- resid.tb1 %>% 
#  dplyr::select(.std.resid) %>%
#  rename(intbautzres = .std.resid)
##############################################################################
```


### H2 Not Included 
```{r introject surface tests, echo=FALSE, eval=FALSE, include=FALSE}
# H2

## 2. Paired Sample T-tests for Difference Scores (H3)
#Paired T-test for pre and post difference scores in affiliation for all surfaces and all groups - not comparing groups - and for interpersonal surfaces.

# extra - we do not use
coefficents_long %>%
  filter(surface == "surf_1") %>%
  group_by(surface, group) %>%
  do(tidy(t.test(.$pre, .$post, paired=TRUE)))  
```


### H3 Not Included

```{r graph h3 t-tests, echo=FALSE, include=FALSE, eval=FALSE}  
  h3_final %>%
  ggplot(aes(statistic, sasb_surface)) +
  geom_point() +
  geom_errorbarh(aes(xmin = conf.low,
                     xmax = conf.high)) +
  labs(y = "SASB Surface",
       x = "T Statistic",
       title = "Independent T-Tests Comparing Differences in Residual Change \non SASB Introject Surface for Affiliation for Pre- and Post-Substance Use (95% CI)",
       caption = "Note. int-aff= introject affiliation; Dashed lines indicate +/- 1.96 T-Value") +
  coord_flip() +
  xlim(2,-2) +
  geom_vline(xintercept = 1.96, linetype="dashed") +
  geom_vline(xintercept = -1.96, linetype="dashed") +
  theme(plot.caption = element_text(hjust = 0))
```


### H4 Not Included

```{r, eval=FALSE, include=FALSE}
#Empirical Cumulative Distribution Function for Positive
panas_data %>%
  ggplot(aes(panas1_1, group=group)) +
  stat_ecdf(aes(color=group)) +
  ggtitle("ECDF for Positive at Pre")

panas_data %>%
  ggplot(aes(panas1_2, group=group)) +
  stat_ecdf(aes(color=group)) +
  ggtitle("ECDF for Positive at Post")
```



```{r, eval=FALSE, include=FALSE}
#Empirical Cumulative Distribution Function for Negative
panas_data %>%
  ggplot(aes(panas2_1, group=group)) +
  stat_ecdf(aes(color=group)) +
  ggtitle("ECDF for Negative at Pre")

panas_data %>%
  ggplot(aes(panas2_2, group=group)) +
  stat_ecdf(aes(color=group)) +
  ggtitle("ECDF for Negative at Post")
```


```{r, echo=FALSE, include=FALSE, eval=FALSE}
panas_data %>% 
  gather(panas_negative, score, panas2_1, panas2_2, -client_number) %>%
  ggplot(aes(x=panas_negative, y=score)) +
  geom_boxplot() +
  geom_jitter(aes(color=panas_negative)) +
  theme(legend.position = "none")
```

### H5 Not Included

```{r, echo=FALSE, include=FALSE, eval=FALSE}
panas_data %>% 
  gather(panas_positive, score, panas1_1, panas1_2, -client_number) %>%
  ggplot(aes(x=panas_positive, y=score)) +
  geom_boxplot() +
  geom_jitter(aes(color=panas_positive)) +
  theme(legend.position = "none")
```
